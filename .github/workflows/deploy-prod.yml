name: Deploy to Production

concurrency:
    group: deploy-production
    cancel-in-progress: false

on:
    push:
        branches: [main]
    workflow_dispatch:

jobs:
    quality-checks:
        name: Quality Checks
        uses: NextNodeSolutions/github-actions/.github/workflows/quality-checks.yml@main
        with:
            run-lint: true
            run-typecheck: true
            run-tests: true
            run-build: true
            run-security: true
            test-coverage: true
        secrets: inherit

    approval:
        name: Waiting for Approval
        needs: quality-checks
        runs-on: ubuntu-latest
        environment: production
        steps:
            - run: echo "Production deployment approved"

    deploy:
        name: Deploy to Production
        needs: approval
        uses: NextNodeSolutions/github-actions/.github/workflows/app-deploy.yml@main
        with:
            environment: production
        secrets: inherit
