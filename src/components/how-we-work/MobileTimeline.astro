---
import { STEP_KEYS, STEP_COLORS } from '@/lib/workflow-constants'
import { generateDetailedSteps } from '@/lib/workflow-utils'
import StepCard from './StepCard.astro'

// Générer les données des étapes
const detailedSteps = generateDetailedSteps()
---

<div class="mobile-timeline w-full py-12">
	<div class="relative mx-auto max-w-3xl pr-6 pl-2">
		{/* Steps container with timeline inside */}
		<div class="relative space-y-12">
			{/* Timeline connector line - now inside the steps container */}
			<div
				class="absolute top-0 left-4 h-full w-px bg-gradient-to-b from-indigo-500 via-amber-500 via-emerald-500 via-purple-500 via-red-500 to-gray-500 opacity-30"
			>
			</div>
			{
				detailedSteps.map((step, index) => {
					const color = STEP_COLORS[index]
					const isLast = index === detailedSteps.length - 1

					return (
						<div
							class="timeline-step relative ml-14"
							data-step-card
							data-step-index={index}
						>
							{/* Timeline node */}
							<div
								class="absolute top-8 -left-12 z-10 flex h-4 w-4 items-center justify-center"
								style={`animation-delay: ${index * 200}ms`}
							>
								<div
									class="timeline-node h-4 w-4 rounded-full border-4 border-white bg-gradient-to-r shadow-lg dark:border-gray-900"
									style={`background: linear-gradient(135deg, ${color}, ${STEP_COLORS[(index + 1) % STEP_COLORS.length]})`}
								/>
							</div>

							{/* Progress pulse effect */}
							<div
								class="absolute top-6 -left-14 z-0 h-8 w-8 animate-ping rounded-full opacity-20"
								style={`background: ${color}; animation-delay: ${index * 200 + 100}ms`}
							/>

							{/* Step card - Direct without wrapper */}
							<div
								class="timeline-card transform transition-all duration-700 ease-out"
								style={`animation-delay: ${index * 150}ms`}
							>
								<StepCard stepKey={step.id} index={index} />
							</div>
						</div>
					)
				})
			}
		</div>

		{/* Decorative elements */}
		<div
			class="absolute top-1/4 -left-1 h-2 w-2 animate-pulse rounded-full bg-indigo-500/20"
		>
		</div>
		<div
			class="absolute top-1/2 -right-4 h-3 w-3 animate-pulse rounded-full bg-purple-500/20"
			style="animation-delay: 1s;"
		>
		</div>
		<div
			class="absolute bottom-1/4 left-0 h-1.5 w-1.5 animate-pulse rounded-full bg-emerald-500/20"
			style="animation-delay: 2s;"
		>
		</div>
	</div>
</div>

<style>
	/* Timeline animations */
	@keyframes fadeInUp {
		from {
			opacity: 0;
			transform: translateY(30px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	@keyframes scaleIn {
		from {
			opacity: 0;
			transform: scale(0);
		}
		to {
			opacity: 1;
			transform: scale(1);
		}
	}

	.timeline-card {
		opacity: 0;
		animation: fadeInUp 0.8s ease-out forwards;
	}

	.timeline-node {
		opacity: 0;
		animation: scaleIn 0.6s ease-out forwards;
		transform: scale(0);
	}

	/* Interactive effects */
	.timeline-step:hover .timeline-node {
		transform: scale(1.2);
		box-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
	}

	.timeline-step:hover .timeline-card {
		transform: translateX(4px);
	}

	/* Dark mode adjustments */
	@media (prefers-color-scheme: dark) {
		.timeline-node {
			border-color: #111827;
		}
	}

	/* Smooth performance without clipping effects */
	.timeline-step {
		will-change: transform;
		/* Remove contain to allow shadows and effects to overflow */
	}

	/* Accessibility */
	@media (prefers-reduced-motion: reduce) {
		.timeline-card,
		.timeline-node {
			animation: none;
			opacity: 1;
			transform: none;
		}
	}
</style>
