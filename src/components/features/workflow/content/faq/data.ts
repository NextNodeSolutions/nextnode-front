import { t } from '@/lib/i18n/i18n-server'
import { sortQuestionsByDifficulty } from '@/utils/faq-helpers'

import type { FAQQuestion, FAQCategory } from './types'

// Configuration centralisÃ©e des catÃ©gories FAQ
export const FAQ_CATEGORIES_CONFIG = {
	gettingStarted: {
		icon: 'ðŸš€',
		difficulty: 'beginner' as const,
	},
	business: { icon: 'ðŸ’¼', difficulty: 'advanced' as const },
	design: { icon: 'ðŸŽ¨', difficulty: 'intermediate' as const },
	performance: {
		icon: 'âš¡',
		difficulty: 'advanced' as const,
	},
	security: { icon: 'ðŸ”’', difficulty: 'intermediate' as const },
	integrations: {
		icon: 'ðŸ”—',
		difficulty: 'advanced' as const,
	},
	marketing: {
		icon: 'ðŸ“ˆ',
		difficulty: 'intermediate' as const,
	},
} as const

export type FAQCategoryId = 'all' | keyof typeof FAQ_CATEGORIES_CONFIG

interface I18nQuestionData {
	question: string
	answer: string
}

/**
 * Helper type-safe pour accÃ©der aux donnÃ©es i18n d'une catÃ©gorie FAQ
 * Throw une erreur explicite si les donnÃ©es n'existent pas (pas de fallback)
 */
function getFAQCategoryData(categoryKey: string): I18nQuestionData[] {
	try {
		// AccÃ¨s aux donnÃ©es i18n avec un seul cast propre
		const categoryData = (t as unknown as (key: string) => unknown)(
			`howWeWork.faq.questions.${categoryKey}`,
		)

		if (!Array.isArray(categoryData)) {
			throw new Error(
				`FAQ category '${categoryKey}' is not an array in i18n data`,
			)
		}

		return categoryData as I18nQuestionData[]
	} catch (error) {
		throw new Error(
			`Failed to load FAQ data for category '${categoryKey}': ${error instanceof Error ? error.message : String(error)}`,
		)
	}
}

export function getFAQQuestions(): FAQQuestion[] {
	const allQuestions: FAQQuestion[] = []

	// ItÃ©ration gÃ©nÃ©rique sur la configuration au lieu de duplication
	Object.entries(FAQ_CATEGORIES_CONFIG).forEach(([categoryKey, config]) => {
		const categoryQuestions = getFAQCategoryData(categoryKey)

		categoryQuestions.forEach((questionData, questionIndex) => {
			allQuestions.push({
				id: `faq-${categoryKey}-${questionIndex}`,
				question: questionData.question,
				answer: questionData.answer,
				icon: config.icon,
				category: categoryKey as keyof typeof FAQ_CATEGORIES_CONFIG,
				difficulty: config.difficulty,
				tags: [categoryKey, 'development'],
			})
		})
	})

	// Trier par difficultÃ© : beginner -> intermediate -> advanced
	return sortQuestionsByDifficulty(allQuestions)
}

export function getFAQCategories(): FAQCategory[] {
	return [
		{
			id: 'all',
			name: t('howWeWork.faqCategories.all'),
			icon: 'ðŸ“‹',
		},
		{
			id: 'gettingStarted',
			name: t('howWeWork.faqCategories.gettingStarted'),
			icon: 'ðŸš€',
		},
		{
			id: 'business',
			name: t('howWeWork.faqCategories.business'),
			icon: 'ðŸ’¼',
		},
		{
			id: 'design',
			name: t('howWeWork.faqCategories.design'),
			icon: 'ðŸŽ¨',
		},
		{
			id: 'performance',
			name: t('howWeWork.faqCategories.performance'),
			icon: 'âš¡',
		},
		{
			id: 'security',
			name: t('howWeWork.faqCategories.security'),
			icon: 'ðŸ”’',
		},
		{
			id: 'integrations',
			name: t('howWeWork.faqCategories.integrations'),
			icon: 'ðŸ”—',
		},
		{
			id: 'marketing',
			name: t('howWeWork.faqCategories.marketing'),
			icon: 'ðŸ“ˆ',
		},
	]
}
