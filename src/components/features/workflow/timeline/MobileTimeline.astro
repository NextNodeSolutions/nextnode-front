---
import { STEP_COLORS } from '../workflow-constants'
import type { Step } from '@/types/workflow'
import TimelineNode from './TimelineNode.astro'
import StepCardWrapper from '../cards/StepCard.wrapper.astro'
import { cn } from '@/lib/core/utils'

export interface Props {
	steps: Step[]
}

const { steps } = Astro.props
---

<div class="mobile-timeline w-full py-12">
	<div class="relative mx-auto max-w-3xl pr-6 pl-2">
		{/* Steps container with timeline inside */}
		<div class="relative space-y-12">
			{/* Timeline connector line - now inside the steps container */}
			<div
				class="absolute top-0 left-4 h-full w-px bg-gradient-to-b from-indigo-500 via-amber-500 via-emerald-500 via-purple-500 via-red-500 to-gray-500 opacity-30"
			>
			</div>
			{
				steps.map((step, index) => {
					const color = STEP_COLORS[index]!

					return (
						<div class="timeline-step relative ml-14">
							{/* Timeline node with modular component */}
							<TimelineNode color={color} index={index} />

							{/* Step card with animation wrapper */}
							<div
								class={cn(
									'animate-in animate-slide-in-from-bottom-8 animate-fill-mode-forwards transform opacity-0 transition-all duration-700 hover:translate-x-1 motion-reduce:animate-none motion-reduce:opacity-100',
								)}
								style={`animation-delay: ${index * 150}ms`}
								data-step-card
								data-step-index={index}
							>
								<StepCardWrapper
									stepKey={step.id}
									index={index}
								/>
							</div>
						</div>
					)
				})
			}
		</div>
	</div>
</div>

<style>
	/* Container styles only - animations moved to components */
	.timeline-step {
		will-change: transform;
	}

	/* Interactive effects */
	.timeline-step:hover .timeline-node {
		transform: scale(1.2);
		box-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
	}

	.timeline-step:hover .timeline-card {
		transform: translateX(4px);
	}
</style>
