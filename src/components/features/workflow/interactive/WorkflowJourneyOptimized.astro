---
import { STEP_COLORS, generateGradientStops } from '../workflow-constants'
import {
	VIEWBOX_WIDTH,
	VIEWBOX_HEIGHT,
	type WorkflowVariant,
} from './workflow-positioning'
import WorkflowSVGLayer from './WorkflowSVGLayer.astro'
import WorkflowCardsLayer from './WorkflowCardsLayer.astro'

export interface Props {
	variant?: WorkflowVariant
}

const { variant = 'mini' } = Astro.props

// Generate gradient stops for the workflow path
const gradientStops = generateGradientStops(STEP_COLORS)

// Container dimensions based on variant
const containerClasses = {
	mini: 'h-64 md:h-80',
	compact: 'h-72 md:h-96',
	large: 'h-80 md:h-[28rem]',
}
---

<!-- Workflow Journey Container -->
<div
	class={`workflow-journey-container relative w-full overflow-hidden rounded-2xl ${containerClasses[variant]}`}
	data-workflow-variant={variant}
	style={`aspect-ratio: ${VIEWBOX_WIDTH}/${VIEWBOX_HEIGHT}`}
>
	<!-- Background SVG Layer (paths and gradients) -->
	<WorkflowSVGLayer gradientStops={gradientStops} />

	<!-- Interactive Cards Layer -->
	<WorkflowCardsLayer variant={variant} />

	<!-- Background decoration -->
	<div
		class="pointer-events-none absolute inset-0 bg-gradient-to-br from-blue-50/30 to-purple-50/30 dark:from-blue-900/10 dark:to-purple-900/10"
	>
	</div>
</div>

<style>
	.workflow-journey-container {
		/* Ensure proper stacking context */
		isolation: isolate;
	}

	/* Responsive scaling for different screen sizes */
	@media (max-width: 768px) {
		.workflow-journey-container {
			/* Scale down slightly on mobile for better fit */
			transform: scale(0.95);
		}
	}
</style>
