---
import { cva } from 'class-variance-authority'
import { cn } from '@/lib/core/utils'
import { translatePlan } from '@/lib/i18n/translate-utils'
import PricingCardBadge from './PricingCardBadge.astro'
import PricingCardHeader from './PricingCardHeader.astro'
import PricingCardFeatures from './PricingCardFeatures.astro'
import PricingCardExamples from './PricingCardExamples.astro'
import PricingCardCTA from './PricingCardCTA.astro'
import type { Plan } from '@/types/plans'

const { t } = Astro.locals

export interface Props {
	plan: Plan
	featured?: boolean
	animationDelay?: number
	className?: string
}

const {
	plan,
	featured = false,
	animationDelay = 0,
	className = '',
} = Astro.props

const planData = translatePlan(plan)
const examplesTitle = t('pricing.sections.examplesTitle')

// Card container variants
const cardVariants = cva(
	[
		'relative flex flex-col h-full',
		'rounded-2xl border border-gray-200/50',
		'bg-white/80 backdrop-blur-sm',
		'dark:border-gray-700/50 dark:bg-gray-800/80',
		'transition-all duration-500',
		'hover:shadow-lg md:hover:scale-105',
		'opacity-0 animate-fade-in-up',
		'p-4 sm:p-6 lg:p-8',
	],
	{
		variants: {
			plan: {
				starter: '',
				business: '',
				enterprise: '',
			},
			featured: {
				true: [
					'ring-2',
					'shadow-lg sm:shadow-xl lg:shadow-2xl',
					'sm:scale-105 lg:scale-110',
					'dark:shadow-none',
				],
				false: '',
			},
		},
		compoundVariants: [
			{
				plan: 'starter',
				featured: true,
				class: 'ring-brand-blue/20 shadow-brand-blue/25',
			},
			{
				plan: 'business',
				featured: true,
				class: 'ring-brand-green/20 shadow-brand-green/25',
			},
			{
				plan: 'enterprise',
				featured: true,
				class: 'ring-brand-blue-dark/20 shadow-brand-blue-dark/25',
			},
		],
	},
)

// Decorative background variants
const decorativeVariants = cva(
	[
		'absolute inset-0 rounded-2xl',
		'opacity-0 transition-opacity duration-500',
		'bg-gradient-to-br pointer-events-none',
		'group-hover:opacity-5',
	],
	{
		variants: {
			plan: {
				starter: 'from-brand-blue to-brand-blue-dark',
				business: 'from-brand-green to-brand-green-dark',
				enterprise: 'from-brand-blue-dark to-brand-green-dark',
			},
		},
	},
)
---

<div
	class={cn(cardVariants({ plan, featured }), className)}
	style={{
		animationDelay: animationDelay > 0 ? `${animationDelay}ms` : undefined,
	}}
>
	{featured && <PricingCardBadge plan={plan} badge={planData.badge} />}

	<PricingCardHeader
		plan={plan}
		name={planData.name}
		tagline={planData.tagline}
		price={planData.price}
		recurring={planData.recurring}
		description={planData.description}
	/>

	<PricingCardFeatures plan={plan} features={planData.features} />

	<PricingCardExamples
		plan={plan}
		title={examplesTitle}
		examples={planData.examples}
	/>

	<PricingCardCTA plan={plan} ctaText={planData.cta} />

	<!-- Decorative background -->
	<div class={cn(decorativeVariants({ plan }))}></div>
</div>
