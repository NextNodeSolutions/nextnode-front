---
import { cn } from '@/lib/core/utils'
import { Brain, Infinity, Rocket, Search, Shield, Zap } from 'lucide-react'

import {
	ANIMATION_DELAYS,
	DECORATIVE_CONFIG,
	getRegularCardDelay,
} from '@/lib/config/marketing/tech-animation-config'
import {
	BENEFIT_CARDS,
	MARKETING_CARDS,
	MARKETING_GRADIENTS,
	MARKETING_LAYOUT,
	MARKETING_SPACING,
	MARKETING_TYPOGRAPHY,
	DECORATIVE_ELEMENTS,
} from '@/lib/ui/marketing-constants'

import OrbitingTech from './OrbitingTech'
import { TransformationBeams } from './TransformationBeams'

const { t } = Astro.locals

// ============================================================================
// BENEFITS DATA
// ============================================================================

const benefits = [
	{
		id: 'mentalHealth',
		icon: Brain,
		title: t('home.techTransform.benefits.mentalHealth.title'),
		description: t('home.techTransform.benefits.mentalHealth.description'),
		metric: t('home.techTransform.benefits.mentalHealth.metric'),
		hero: true,
	},
	{
		id: 'seoGrowth',
		icon: Search,
		title: t('home.techTransform.benefits.seoGrowth.title'),
		description: t('home.techTransform.benefits.seoGrowth.description'),
		metric: t('home.techTransform.benefits.seoGrowth.metric'),
	},
	{
		id: 'performance',
		icon: Zap,
		title: t('home.techTransform.benefits.performance.title'),
		description: t('home.techTransform.benefits.performance.description'),
		metric: t('home.techTransform.benefits.performance.metric'),
	},
	{
		id: 'security',
		icon: Shield,
		title: t('home.techTransform.benefits.security.title'),
		description: t('home.techTransform.benefits.security.description'),
		metric: t('home.techTransform.benefits.security.metric'),
	},
	{
		id: 'speed',
		icon: Rocket,
		title: t('home.techTransform.benefits.speed.title'),
		description: t('home.techTransform.benefits.speed.description'),
		metric: t('home.techTransform.benefits.speed.metric'),
	},
	{
		id: 'scalability',
		icon: Infinity,
		title: t('home.techTransform.benefits.scalability.title'),
		description: t('home.techTransform.benefits.scalability.description'),
		metric: t('home.techTransform.benefits.scalability.metric'),
	},
]

const heroBenefit = benefits.find(b => b.hero)
const regularBenefits = benefits.filter(b => !b.hero)
---

<section
	class={cn(
		'relative overflow-hidden',
		MARKETING_LAYOUT.section.padding,
		MARKETING_GRADIENTS.sectionBg,
	)}
>
	<!-- Grid Pattern Background -->
	<div class="absolute inset-0 opacity-[0.03] dark:opacity-[0.05]">
		<div
			class="absolute inset-0 bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px]"
		>
		</div>
	</div>

	<!-- Decorative blobs -->
	<div class={DECORATIVE_CONFIG.blobs.green.classes}></div>
	<div class={DECORATIVE_CONFIG.blobs.blue.classes}></div>

	<div
		class={cn(
			'relative mx-auto',
			MARKETING_LAYOUT.section.maxWidth,
			MARKETING_LAYOUT.section.containerPadding,
		)}
		id="tech-transform-section"
	>
		<!-- Section Header -->
		<div
			class={cn(
				MARKETING_SPACING.sectionGap,
				MARKETING_SPACING.headerGap,
				'text-center',
			)}
		>
			<h2
				class={cn(
					'tech-animate tech-animate-fade-in-up',
					MARKETING_TYPOGRAPHY.sectionTitle,
				)}
				data-delay={ANIMATION_DELAYS.title}
			>
				{t('home.techTransform.title')}
			</h2>
			<p
				class={cn(
					'tech-animate tech-animate-fade-in-up',
					MARKETING_TYPOGRAPHY.sectionSubtitle,
				)}
				data-delay={ANIMATION_DELAYS.subtitle}
			>
				{t('home.techTransform.subtitle')}
			</p>
		</div>

		<!-- Transformation Container -->
		<div
			class={cn(
				MARKETING_LAYOUT.grid.techTransform.cols,
				MARKETING_LAYOUT.grid.techTransform.gap,
			)}
		>
			<!-- Technologies Cloud (Left) -->
			<div
				class={cn(
					MARKETING_LAYOUT.grid.techTransform.spans.tech,
					'tech-animate tech-animate-fade-in-up',
				)}
				data-delay={ANIMATION_DELAYS.techSection}
			>
				<div class={MARKETING_CARDS.container}>
					<h3
						class="mb-6 text-center text-xl font-bold text-gray-900 dark:text-white"
					>
						{t('home.techTransform.techSection.title')}
					</h3>
					<OrbitingTech client:only="react" />
				</div>
			</div>

			<!-- Transformation Beams (Center) -->
			<div
				class={cn(
					MARKETING_LAYOUT.grid.techTransform.spans.beams,
					'tech-animate tech-animate-fade-in',
					'flex items-center justify-center py-8 lg:py-0',
				)}
				data-delay={ANIMATION_DELAYS.beams}
			>
				<div class="relative h-[250px] w-full">
					<TransformationBeams client:load />
				</div>
			</div>

			<!-- Benefits Bento Grid (Right) -->
			<div
				class={cn(
					MARKETING_LAYOUT.grid.techTransform.spans.benefits,
					'tech-animate tech-animate-fade-in-up',
				)}
				data-delay={ANIMATION_DELAYS.benefits}
			>
				<div class={MARKETING_CARDS.benefits}>
					<h3
						class="mb-6 text-center text-xl font-bold text-gray-900 dark:text-white"
					>
						{t('home.techTransform.benefitsSection.title')}
					</h3>

					<!-- Bento Grid -->
					<div class="benefits-bento-grid">
						<!-- Hero Benefit Card -->
						{
							heroBenefit && (
								<div
									class={cn(
										BENEFIT_CARDS.hero,
										'bento-hero tech-animate',
									)}
									data-delay={ANIMATION_DELAYS.heroCard}
								>
									<div
										class={
											DECORATIVE_ELEMENTS.gradientAnimated
										}
									/>

									<div
										class={cn(
											'relative z-10 flex h-full flex-col justify-between',
											MARKETING_SPACING.cardGap,
										)}
									>
										<div
											class={
												BENEFIT_CARDS.heroIconContainer
											}
										>
											<heroBenefit.icon className="h-8 w-8 text-white" />
										</div>

										<div
											class={cn(
												'flex-1',
												MARKETING_SPACING.cardTight,
											)}
										>
											<h4
												class={
													MARKETING_TYPOGRAPHY.heroBenefitTitle
												}
											>
												{heroBenefit.title}
											</h4>
											<p
												class={
													MARKETING_TYPOGRAPHY.heroBenefitDescription
												}
											>
												{heroBenefit.description}
											</p>
										</div>

										<div class="flex justify-end">
											<span
												class={
													MARKETING_TYPOGRAPHY.heroMetricBadge
												}
											>
												{heroBenefit.metric}
											</span>
										</div>
									</div>
								</div>
							)
						}

						<!-- Regular Benefit Cards -->
						{
							regularBenefits.map((benefit, index) => (
								<div
									class={cn(
										BENEFIT_CARDS.regular,
										'bento-card tech-animate',
									)}
									data-delay={getRegularCardDelay(index)}
								>
									<div
										class={cn(
											'relative z-10',
											MARKETING_SPACING.cardTight,
										)}
									>
										<div class="flex items-start justify-between gap-2">
											<div
												class={
													BENEFIT_CARDS.iconContainer
												}
											>
												<benefit.icon className="h-4 w-4 text-white" />
											</div>
											<span
												class={
													MARKETING_TYPOGRAPHY.metricBadge
												}
											>
												{benefit.metric}
											</span>
										</div>

										<h4
											class={
												MARKETING_TYPOGRAPHY.benefitTitle
											}
										>
											{benefit.title}
										</h4>
										<p
											class={
												MARKETING_TYPOGRAPHY.benefitDescription
											}
										>
											{benefit.description}
										</p>
									</div>

									<div
										class={DECORATIVE_ELEMENTS.hoverGlow}
									/>
								</div>
							))
						}
					</div>
				</div>
			</div>
		</div>

		<!-- Bottom CTA Message -->
		<div
			class={cn('tech-animate tech-animate-fade-in-up mt-16 text-center')}
			data-delay={ANIMATION_DELAYS.ctaMessage}
		>
			<p
				class="mx-auto max-w-3xl text-lg font-medium text-gray-700 dark:text-gray-300"
			>
				{t('home.techTransform.ctaMessage')}
			</p>
		</div>
	</div>
</section>

<style>
	/* ========================================================================
	   ANIMATION STATES
	   ======================================================================== */

	/* Initial state - hidden before animation trigger */
	.tech-animate:not(.tech-animated) {
		opacity: 0;
	}

	/* Triggered animation state */
	.tech-animate.tech-animating.tech-animate-fade-in-up {
		animation: fadeInUp 0.8s ease-out forwards;
	}

	.tech-animate.tech-animating.tech-animate-fade-in {
		animation: fadeIn 0.8s ease-out forwards;
	}

	/* Final state after animation - visible and stable */
	.tech-animate.tech-animated {
		opacity: 1;
		transform: none;
	}

	/* ========================================================================
	   KEYFRAME ANIMATIONS
	   ======================================================================== */

	@keyframes fadeInUp {
		from {
			opacity: 0;
			transform: translateY(30px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	@keyframes fadeIn {
		from {
			opacity: 0;
		}
		to {
			opacity: 1;
		}
	}

	@keyframes pulseRing {
		0% {
			transform: scale(1);
			opacity: 0.5;
		}
		100% {
			transform: scale(2);
			opacity: 0;
		}
	}

	@keyframes gradientShift {
		0% {
			background-position: 0% 50%;
		}
		50% {
			background-position: 100% 50%;
		}
		100% {
			background-position: 0% 50%;
		}
	}

	@keyframes iconPulse {
		0% {
			transform: scale(1);
			box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
		}
		50% {
			transform: scale(1.05);
			box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
		}
	}

	/* ========================================================================
	   BACKGROUND EFFECTS
	   ======================================================================== */

	.gradient-animated {
		background: linear-gradient(
			45deg,
			var(--brand-blue) 0%,
			var(--brand-green) 50%,
			var(--brand-blue) 100%
		);
		background-size: 200% 200%;
		animation: gradientShift 8s ease infinite;
	}

	.icon-pulse {
		animation: iconPulse 2s ease-in-out infinite;
	}

	/* ========================================================================
	   BENTO GRID LAYOUT
	   ======================================================================== */

	.benefits-bento-grid {
		display: grid;
		grid-template-columns: repeat(2, 1fr);
		grid-template-rows: repeat(3, auto);
		gap: 1rem;
		grid-template-areas:
			'hero hero'
			'card1 card2'
			'card3 card4'
			'card5 card5';
	}

	.bento-hero {
		grid-area: hero;
		min-height: 200px;
	}

	.bento-card:nth-of-type(1) {
		grid-area: card1;
	}
	.bento-card:nth-of-type(2) {
		grid-area: card2;
	}
	.bento-card:nth-of-type(3) {
		grid-area: card3;
	}
	.bento-card:nth-of-type(4) {
		grid-area: card4;
	}
	.bento-card:nth-of-type(5) {
		grid-area: card5;
	}

	/* Mobile layout - single column */
	@media (max-width: 640px) {
		.benefits-bento-grid {
			grid-template-columns: 1fr;
			grid-template-areas:
				'hero'
				'card1'
				'card2'
				'card3'
				'card4'
				'card5';
		}

		.bento-hero {
			min-height: 220px;
		}
	}

	/* Animation delay utility */
	.animation-delay-2000 {
		animation-delay: 2s;
	}
</style>

<script>
	import { setupTechTransformAnimation } from './TechTransformationObserver'

	// Initialize animation observer
	setupTechTransformAnimation()
</script>
